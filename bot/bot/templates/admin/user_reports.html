{% extends "layout.html" %}

{% block title %}بلاغات المستخدم {{ user.name }} - نقطة وصل{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>بلاغات المستخدم: {{ user.name }}</h1>
            <a href="{{ url_for('admin.users') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-right me-2"></i>العودة لقائمة المستخدمين
            </a>
        </div>
    </div>
</div>

<!-- معلومات المستخدم -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <img src="{{ user.profile_image_url if user.profile_image_url else (user.profile_image | image_url(folder='users')) }}" 
                         alt="{{ user.name }}" 
                         class="rounded-circle me-3"
                         width="64" height="64">
                    <div>
                        <h4 class="mb-1">{{ user.name }}</h4>
                        <p class="mb-0">
                            <a href="mailto:{{ user.email }}">{{ user.email }}</a>
                            {% if user.is_banned %}
                            <span class="badge bg-danger ms-2">محظور</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="ms-auto">
                        <a href="{{ url_for('user.public_profile', user_id=user.id) }}" class="btn btn-sm btn-outline-primary me-2">
                            <i class="fas fa-user me-1"></i> عرض الملف الشخصي
                        </a>
                        <a href="{{ url_for('admin.user_products', user_id=user.id) }}" class="btn btn-sm btn-outline-success">
                            <i class="fas fa-shopping-bag me-1"></i> عرض المنتجات
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- البلاغات المقدمة من المستخدم -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">البلاغات المقدمة من المستخدم</h5>
            </div>
            <div class="card-body">
                {% if reports_filed %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>رقم البلاغ</th>
                                <th>النوع</th>
                                <th>السبب</th>
                                <th>التاريخ</th>
                                <th>الحالة</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports_filed %}
                            <tr>
                                <td>#{{ report.id }}</td>
                                <td>
                                    {% if report.product_id %}
                                        <i class="fas fa-shopping-bag me-2 text-primary"></i>منتج
                                    {% elif report.reported_user_id %}
                                        <i class="fas fa-user me-2 text-danger"></i>مستخدم
                                    {% endif %}
                                </td>
                                <td>{{ report.reason }}</td>
                                <td>{{ report.created_at | time_since }}</td>
                                <td>
                                    {% if report.status == 'pending' %}
                                        <span class="badge bg-warning">قيد الانتظار</span>
                                    {% elif report.status == 'resolved' %}
                                        <span class="badge bg-success">تم الحل</span>
                                    {% elif report.status == 'rejected' %}
                                        <span class="badge bg-danger">مرفوض</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('admin.report_details', report_id=report.id) }}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye"></i> عرض
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center text-muted my-4">لم يقم هذا المستخدم بتقديم أي بلاغات</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- البلاغات المقدمة ضد المستخدم -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">البلاغات المقدمة ضد المستخدم</h5>
            </div>
            <div class="card-body">
                {% if reports_received %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>رقم البلاغ</th>
                                <th>المُبلِغ</th>
                                <th>السبب</th>
                                <th>التاريخ</th>
                                <th>الحالة</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports_received %}
                            <tr>
                                <td>#{{ report.id }}</td>
                                <td>
                                    <a href="{{ url_for('user.public_profile', user_id=report.reporter.id) }}">
                                        {{ report.reporter.name }}
                                    </a>
                                </td>
                                <td>{{ report.reason }}</td>
                                <td>{{ report.created_at | time_since }}</td>
                                <td>
                                    {% if report.status == 'pending' %}
                                        <span class="badge bg-warning">قيد الانتظار</span>
                                    {% elif report.status == 'resolved' %}
                                        <span class="badge bg-success">تم الحل</span>
                                    {% elif report.status == 'rejected' %}
                                        <span class="badge bg-danger">مرفوض</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('admin.report_details', report_id=report.id) }}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye"></i> عرض
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center text-muted my-4">لم يتم تقديم أي بلاغات ضد هذا المستخدم</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}